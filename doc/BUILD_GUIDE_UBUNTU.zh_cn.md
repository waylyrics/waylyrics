# Waylyrics Ubuntuç”¨æˆ·ç¼–è¯‘æŒ‡å— (2024.06.01)

## ç›®å½•
- [è§‚å‰æç¤º](#è§‚å‰æç¤º)
- [å‡†å¤‡ç¯å¢ƒ](#å‡†å¤‡ç¯å¢ƒ)
- [å…‹éš†æºç ](#å…‹éš†æºç )
- [å¼€å§‹ç¼–è¯‘](#å¼€å§‹ç¼–è¯‘)
  - [ä½¿ç”¨ stable å·¥å…·é“¾](#ä½¿ç”¨-stable-å·¥å…·é“¾)
  - [ä½¿ç”¨ nightly å·¥å…·é“¾](#ä½¿ç”¨-nightly-å·¥å…·é“¾)
- [å¤åˆ¶äºŒè¿›åˆ¶åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ–‡ä»¶å¤¹ä¸‹](#å¤åˆ¶äºŒè¿›åˆ¶åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ–‡ä»¶å¤¹ä¸‹)
- [ç¼–è¯‘ schemas](#ç¼–è¯‘-schemas)
- [è½¯ä»¶å›¾æ ‡è®¾ç½®](#è½¯ä»¶å›¾æ ‡è®¾ç½®)
- [æ¡Œé¢å›¾æ ‡è®¾ç½®](#æ¡Œé¢å›¾æ ‡è®¾ç½®)
- [è½¯ä»¶ä¸»é¢˜è®¾ç½®](#è½¯ä»¶ä¸»é¢˜è®¾ç½®)
- [ç¼–è¯‘ç»“æŸ](#ç¼–è¯‘ç»“æŸ)
- [Waylyric ä¸€äº›å¸¸è§ä½¿ç”¨æŠ€å·§](#waylyric-ä¸€äº›å¸¸è§ä½¿ç”¨æŠ€å·§)
  - [ç½®é¡¶æ­Œè¯](#ç½®é¡¶æ­Œè¯)

## è§‚å‰æç¤º
è¿™é‡Œæ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯è¿è¡Œåœ¨æ™®é€šç”¨æˆ·ä¸‹çš„ï¼Œè¯·ç†è§£æ¯æ¡å‘½ä»¤çš„ä½œç”¨ä¹‹åå†è¿è¡Œã€‚å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œè¯·é€‚å½“ä½¿ç”¨ sudo ææƒã€‚

åœ¨ç¼–è¯‘å¼€å§‹ä¹‹å‰ï¼Œè¯·ä¿è¯ä½ çš„ç½‘ç»œé€šè®¯è‰¯å¥½ï¼Œå¦åˆ™å¾ˆå¯èƒ½ä¼šåœ¨ç¼–è¯‘å¼€å§‹æ—¶å¡ä½ã€‚

è¿™ç¯‡æ–‡æ¡£é»˜è®¤å…¨å±€å®‰è£… Waylyrics ï¼Œé«˜çº§ç©å®¶å¯ä»¥å°†éƒ¨åˆ†æ–‡ä»¶æ”¾å…¥ ~/.local/share ä¸­ã€‚

æˆ–è€…å¯ä»¥ä»[æ˜Ÿç«å•†åº—](https://spark-app.store/)å®‰è£…å·²ç»ç¼–è¯‘å¥½äº†çš„äºŒè¿›åˆ¶åŒ…ã€‚
```shell
sudo aptss install waylyrics
```

## å‡†å¤‡ç¯å¢ƒ
```shell
sudo apt-get install git nano build-essential libssl-dev libgtk-4-dev libdbus-1-dev libmimalloc-dev gettext cargo
```
ğŸ“£Tipsï¼šè¿™é‡Œçš„ cargo è½¯ä»¶åŒ…ä¼šæ‹‰èµ· rustc è½¯ä»¶åŒ…ï¼Œè¯·æ³¨æ„è¿™é‡Œçš„rustc è½¯ä»¶åŒ…ç‰ˆæœ¬éœ€è¦ >= 1.73ã€‚é«˜é˜¶ç©å®¶å¯ä»¥è‡ªå·±æ­å»º rust ç¯å¢ƒï¼Œä¸ç”¨ä»åŒ…ç®¡ç†å™¨å®‰è£… cargo ã€‚

## å…‹éš†æºç 
æˆ‘ä»¬éœ€è¦åœ¨ Github ä¸Šå…‹éš† Waylyrics çš„æºä»£ç æ¥è¿›è¡Œç¼–è¯‘ã€‚è¯·ä¿è¯ç½‘ç»œè¿æ¥é€šç•…ï¼Œéå¸¸æƒ…å†µè¯·ä½¿ç”¨é­”æ³•ğŸª„ã€‚
```shell
mkdir gittemp
cd gittemp
#è¿™é‡Œ mkdir å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º gittemp çš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”ä½¿ç”¨ cd å‘½ä»¤åˆ‡æ¢å‘½ä»¤è¡Œå·¥ä½œç›®å½•ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å…‹éš†çš„é¡¹ç›®ä¸æ±¡æŸ“å®¶ç›®å½•ã€‚
git clone https://github.com/waylyrics/waylyrics.git
#ä½¿ç”¨ git å‘½ä»¤å…‹éš†ï¼ˆcloneï¼‰ Waylyrics é¡¹ç›®çš„æºä»£ç ã€‚
cd waylyrics
#ä½¿ç”¨ cd å‘½ä»¤åˆ‡æ¢å‘½ä»¤è¡Œå·¥ä½œç›®å½•åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ã€‚
export WAYLYRICS_THEME_PRESETS_DIR=/usr/share/waylyrics/themes
#è®¾ç½® Waylyrics ä¸»é¢˜ç›®å½•çš„å˜é‡ï¼Œåé¢ä¼šç”¨åˆ°çš„
```
## å¼€å§‹ç¼–è¯‘
ç¼–è¯‘çš„æ—¶å€™æœ‰ stable æ ‡å‡†å·¥å…·é“¾ï¼Œæˆ–è€… nightly æ¯æ—¥æ›´æ–°å·¥å…·é“¾å¯ä»¥é€‰æ‹©ï¼ˆå°ç™½ä¸æ¨è nightly ï¼‰ã€‚

âš ï¸Waringï¼šç¬¬ä¸‰æ¬¡æé†’æ‚¨ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç½‘ç»œé€šç•…ï¼Œå‰æ–¹ä¸‹è½½å·¥å…·é“¾éœ€è¦å¤§é‡æµé‡ã€‚

å¯¹äºå®åœ¨æ²¡æœ‰é­”æ³•çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬è¿™é‡Œæä¾› cargo æ¢æºæ¥ä¸‹è½½å·¥å…·é“¾ï¼

```shell
nano ~/.cargo/cofig.toml
#ä½¿ç”¨ nano æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘ç”¨æˆ·ç›®å½•ä¸‹çš„ .cargo/config
```

å°†ä¸‹é¢æ–‡æœ¬å†…å®¹å¤åˆ¶è¿›æ–‡æœ¬ä¸­ï¼Œæ­¤å¤„æ–‡æœ¬è¡¨ç¤ºçš„æ˜¯[rsproxy.cnæº](https://rsproxy.cn/#getStarted)

```toml
[source.crates-io]
replace-with = 'rsproxy-sparse'
[source.rsproxy]
registry = "https://rsproxy.cn/crates.io-index"
[source.rsproxy-sparse]
registry = "sparse+https://rsproxy.cn/index/"
[registries.rsproxy]
index = "https://rsproxy.cn/crates.io-index"
[net]
git-fetch-with-cli = true
```
ç„¶åæŒ‰ä¸‹ Ctrl+X è¿›å…¥é€€å‡ºæ¨¡å¼ï¼Œè¾“å…¥ "Y" å¹¶ä¸€è·¯å›è½¦å°±å¯ä»¥ä¿å­˜ã€‚


### ä½¿ç”¨ stable å·¥å…·é“¾
```shell
cargo build --release --locked --target-dir target
#ä½¿ç”¨é»˜è®¤è®¾ç½®å¼€å§‹ç¼–è¯‘ï¼Œå¹¶ä¸”å°†ç¼–è¯‘åäºŒè¿›åˆ¶åŒ…è¾“å‡ºåˆ° ./target/release/ æ–‡ä»¶å¤¹ã€‚
```

### ä½¿ç”¨ nightly å·¥å…·é“¾
```shell
cargo +nightly build --release --locked --target-dir target
#ä½¿ç”¨æ¯æ—¥æ›´æ–°å·¥å…·é“¾å¼€å§‹ç¼–è¯‘ï¼Œå¹¶ä¸”å°†ç¼–è¯‘åäºŒè¿›åˆ¶åŒ…è¾“å‡ºåˆ° ./target/release/ æ–‡ä»¶å¤¹ã€‚
```

## å¤åˆ¶äºŒè¿›åˆ¶åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ–‡ä»¶å¤¹ä¸‹
åœ¨ Linux ä¸‹ï¼Œ /bin æ–‡ä»¶å¤¹ä¸‹æ”¾ç€å¾ˆå¤šå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯”å¦‚ apt ã€ grep ç­‰å‘½ä»¤ï¼Œæˆ‘ä»¬æŠŠ waylyrics çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ° /bin ç›®å½•ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ waylyrics å‘½ä»¤å¯åŠ¨ Waylyrics ç¨‹åºã€‚
```shell
sudo cp ./target/release/waylyrics /usr/bin
#å¤åˆ¶ waylyrics äºŒè¿›åˆ¶æ–‡ä»¶åˆ° /bin ç›®å½•ä¸‹
sudo chmod 755 /usr/bin/waylyrics
#è®¾ç½® /usr/bin/waylyrics çš„æƒé™ä¸º755
sudo ln -s /usr/bin/waylyrics /bin/waylyrics
#åˆ›å»ºæ–‡ä»¶é“¾æ¥ï¼Œè®©ç³»ç»Ÿè®¿é—® /bin/waylyrics ç›´æ¥è®¿é—® /usr/bin/waylyrics
```
ğŸ’¡Tipsï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠæ–‡ä»¶æ”¾åœ¨ /bin é‡Œé¢ç›´æ¥è®¿é—®å‘¢ï¼Ÿå…¶å®è¿™æ˜¯å¯ä»¥çš„å“Ÿï¼Œä¸è¿‡æˆ‘ä»¬ä¸ºäº†è§„èŒƒæ¯ä¸€ä¸ªæ–‡ä»¶çš„ä½ç½®ï¼Œæˆ‘ä»¬åº”å½“å»è‡ªè§‰çš„æŠŠäºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨ /usr/bin é‡Œé¢ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸¢å…¥ /bin é‡Œé¢ï¼Œæœ‰ç–‘é—®å¯ä»¥å»çœ‹å…³äº HFS çš„ç™¾ç§‘å“¦ï¼

## ç¼–è¯‘ schemas
Waylyric éœ€è¦é€šè¿‡ GSettings APIï¼ˆGNOMEæ¡Œé¢ç¯å¢ƒè®¾ç½®å­˜å‚¨å’Œæ£€ç´¢ç³»ç»Ÿçš„è°ƒç”¨æ¥å£ï¼Œå› ä¸º Waylyric æ˜¯ GTK è½¯ä»¶ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨æ­¤æ¥å£ï¼‰ æ¥å…è®¸åº”ç”¨ç¨‹åºè¯»å–å’Œå†™å…¥ç”¨æˆ·è®¾ç½®ï¼Œè®©æˆ‘ä»¬æ¥å¼€å§‹ç¼–è¯‘ schemas å§ï¼
```shell
cp ./metainfo/io.github.waylyrics.Waylyrics.gschema.xml /usr/share/glib-2.0/schemas
#å¤åˆ¶ schemas æ–‡ä»¶åˆ° /usr/share/glib-2.0/schemas/ ç›®å½•ä¸‹
glib-compile-schemas /usr/share/glib-2.0/schemas/
#ç¼–è¯‘ schemas æ–‡ä»¶
```

## å¤šè¯­è¨€è®¾ç½®
ğŸ“£Tipsï¼šæ­¤é¡¹ä¸ºå¯é€‰é¡¹ï¼Œå¹¶ä¸ä¼šå½±å“è½¯ä»¶æ­£å¸¸ä½¿ç”¨
```bash
cd locales
for po in $(find . -type f -name '*.po')
do
    mkdir -p ~/.local/share/locale/${po#/*}
    msgfmt -o ~/.local/share/locale/${po%.po}.mo ${po}
done
```

## è½¯ä»¶å›¾æ ‡è®¾ç½®
ğŸ“£Tipsï¼šæ­¤é¡¹å¾ˆé‡è¦ï¼Œä¼šå½±å“è½¯ä»¶çš„æ­£å¸¸ä½¿ç”¨ä½“éªŒ

æˆ‘ä»¬è¦ç»™è½¯ä»¶è®¾ç½®ä¸€ä¸ªå¥½çœ‹çš„ Logo ï¼å½“ç„¶æ˜¯æˆ‘ä»¬å¯çˆ±çš„ Waylyrics å°Fuç‹¸ï¼è®©æˆ‘ä»¬æŠŠå¯çˆ±çš„å°Fuç‹¸å¸¦åˆ°ç³»ç»Ÿä¸­å§ï¼
```shell
cp -r ./res/icons/* /usr/share/icons/
#å°† ./res/icons/ ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»ŸæŒ‡å®šçš„å›¾æ ‡æ–‡ä»¶å¤¹
```

## æ¡Œé¢å›¾æ ‡è®¾ç½®
ğŸ“£Tipsï¼šæ­¤é¡¹å¾ˆé‡è¦ï¼Œä¼šå½±å“è½¯ä»¶çš„æ­£å¸¸ä½¿ç”¨ä½“éªŒ

æˆ‘ä»¬éœ€è¦åœ¨æ¡Œé¢æœ‰ä¸€ä¸ªå¯åŠ¨å›¾æ ‡æ¥æ“ä½œ Waylyrics ï¼Œæ­£å¥½æºç é‡Œé¢ç»™æˆ‘ä»¬æä¾›äº†ç°æˆå¯ç”¨çš„ desktop æ–‡ä»¶æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ°å­˜å‚¨æ¡Œé¢å›¾æ ‡çš„æ–‡ä»¶å¤¹ä¸­å°±å¯ä»¥äº†ã€‚
```shell
#è¯·ç¡®è®¤å‘½ä»¤è¡Œçš„å·¥ä½œç›®å½•åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯åœ¨å­ç›®å½•ä¸‹ï¼Œå¦‚ locales , metainfo ç­‰æ–‡ä»¶å¤¹
cp ./metainfo/io.github.waylyrics.Waylyrics.desktop /usr/share/applications/
#å¤åˆ¶ Waylyrics çš„æ¡Œé¢æ–‡ä»¶åˆ° /usr/share/applications/
sudo chmod 644 /usr/share/applications/io.github.waylyrics.Waylyrics.desktop
#è®¾ç½®æ¡Œé¢å›¾æ ‡çš„æƒé™ä¸º 644
```
## è½¯ä»¶ä¸»é¢˜è®¾ç½®
ğŸ“£Tipsï¼šæ­¤é¡¹ä¸ºå¯é€‰é¡¹ï¼Œå¹¶ä¸ä¼šå½±å“è½¯ä»¶æ­£å¸¸ä½¿ç”¨

å®‰è£…å®Œè½¯ä»¶åè¿˜éœ€è¦æ¼‚äº®çš„ä¸»é¢˜ï¼Œæ­£å¥½ Waylyric æ”¯æŒä¸»é¢˜é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé»˜è®¤ä¸»é¢˜å¤åˆ¶åˆ°æ ‡å‡†ç›®å½•ä¸‹ã€‚
```shell
mkdir -p /usr/share/waylyrics/themes/
#åˆ›å»º /usr/share/waylyrics/themes/ è¿™ä¸€ä¸²æ–‡ä»¶å¤¹
cp -r ./themes/* /usr/share/waylyrics/themes/
#å¤åˆ¶ ./themes/ ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ° /usr/share/waylyrics/themes/
sudo chmod 755 -R /usr/share/waylyrics/themes/
#è®¾ç½®æ–‡ä»¶å¤¹æƒé™ä¸º755
```

## ç¼–è¯‘ç»“æŸ
è‡³æ­¤ï¼Œä½ ä¹Ÿåº”è¯¥å®Œæˆäº†å…¨éƒ¨çš„å®‰è£…è¿‡ç¨‹äº†ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆæœ‰è¶£å‘¢ï¼Ÿä½†æ˜¯ä¸€åˆ‡å·²ç»è¿‡å»ï¼Œè½¯ä»¶çš„ç¼–è¯‘è¿‡ç¨‹å·²ç»å®Œæˆï¼

## Waylyric ä¸€äº›å¸¸è§ä½¿ç”¨æŠ€å·§
### ç½®é¡¶æ­Œè¯
ä¿æŒ Waylyrics çª—å£çŠ¶æ€ï¼Œå³é”®å…¶æ ‡é¢˜æ ï¼Œé€‰æ‹©æ›´å¤šï¼Œé€‰ä¸­ç½®é¡¶ï¼Œç„¶åå…³é—­å…¶çª—å£çŠ¶æ€å°±å¯ä»¥å®ç°æ­Œè¯ç½®é¡¶ã€‚
